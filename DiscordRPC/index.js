import{store as p,intercept as g,currentMediaItem as u}from"@neptune";import{getMediaURLFromID as y}from"@neptune/utils";var a=[],s=t=>t.length>=128?t.slice(0,125)+"...":t,n=new WebSocket("ws://127.0.0.1:6463/?v=1&client_id=1130698654987067493");n.onclose=()=>{a.forEach(t=>t()),a=[],setTimeout(()=>{n=new WebSocket("ws://127.0.0.1:6463/?v=1&client_id=1130698654987067493")},5e3)};n.onopen=b;var b=()=>{a.push(g("playbackControls/TIME_UPDATE",([t])=>{let i=p.getState(),{item:e,type:r}=u;if(r!="track")return;let l=y(e.album.cover),o=new Date,S=o.getTime()/1e3|0,m=o.setSeconds(o.getSeconds()+(e.duration-t)),c=i.playbackControls.playbackState=="NOT_PLAYING";n.send(JSON.stringify({cmd:"SET_ACTIVITY",args:{pid:2094112,activity:{timestamps:{...c?{}:{end:m}},type:2,name:s(e.title),details:s("by "+e.artists.map(d=>d.name).join(", ")),assets:{large_image:l,large_text:`on ${s(e.album.title)}`,...c?{small_image:"paused-icon",small_text:"Paused"}:{}}}}}))}))};async function f(){a.forEach(t=>t());try{n.close()}catch{}}export{f as onUnload};
