var b=Object.create;var l=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var C=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var E=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of f(t))!S.call(e,n)&&n!==s&&l(e,n,{get:()=>t[n],enumerable:!(i=T(t,n))||i.enumerable});return e};var k=(e,t,s)=>(s=e!=null?b(I(e)):{},E(t||!e||!e.__esModule?l(s,"default",{value:e,enumerable:!0}):s,e));var h=C(m=>{var r=class{constructor(t){this.cb=t,this.ws=null,this.tries=0}emit(t,s){this.cb(t,s)}once(t,s){this.cb(t,s)}async connect(){let t=6463+this.tries%10;this.tries+=1,this.ws=new WebSocket(`ws://127.0.0.1:${t}/?v=1&client_id=1130698654987067493`),this.ws.onopen=this.onOpen.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=this.onError.bind(this),this.ws.onmessage=this.onMessage.bind(this)}onOpen(){this.emit("open")}onClose(t){t.wasClean&&this.emit("close",t)}onError(t){try{this.ws.close()}catch{}this.tries>20?this.emit("error",t.error):setTimeout(()=>{this.connect()},250)}onMessage(t){this.emit("message",JSON.parse(t.data))}send(t){this.ws.send(JSON.stringify(t))}ping(){}close(){return new Promise(t=>{this.once("close",t),this.ws.close()})}};m=r});var d=k(h());import{store as M,intercept as O,currentMediaItem as P}from"@neptune";import{getMediaURLFromID as A}from"@neptune/utils";var p=[],a=e=>e.length>=128?e.slice(0,125)+"...":e,c=new d.default(()=>{});c.connect().then(()=>{p.push(O("playbackControls/TIME_UPDATE",([e])=>{let t=M.getState(),{item:s,type:i}=P;if(i!="track")return;let n=A(s.album.cover),o=new Date,g=o.getTime()/1e3|0,u=o.setSeconds(o.getSeconds()+(s.duration-e)),w=t.playbackControls.playbackState=="NOT_PLAYING";c.send({cmd:"SET_ACTIVITY",args:{pid:2094112,activity:{...w?{smallImageKey:"paused-icon",smallImageText:"Paused"}:{startTimestamp:g,endTimestamp:u},type:2,name:a(s.title),details:a("by "+s.artists.map(y=>y.name).join(", ")),largeImageKey:n,largeImageText:`on ${a(s.album.title)}`}}})}))});async function x(){p.forEach(e=>e());try{c.close()}catch{}}export{x as onUnload};
