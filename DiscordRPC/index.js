import{store as y,intercept as u,currentMediaItem as T}from"@neptune";import{getMediaURLFromID as I}from"@neptune/utils";var c=[],a=t=>t.length>=128?t.slice(0,125)+"...":t,o,s,b=async()=>{let t=6463+s%10;s+=1,o=new WebSocket(`ws://127.0.0.1:${t}/?v=1&client_id=1130698654987067493`)},S=t=>{o.send(JSON.stringify(t))},f=()=>new Promise(t=>{o.close(),t()});b().then(()=>{c.push(u("playbackControls/TIME_UPDATE",([t])=>{let r=y.getState(),{item:e,type:i}=T;if(i!="track")return;let l=I(e.album.cover),n=new Date,m=n.getTime()/1e3|0,d=n.setSeconds(n.getSeconds()+(e.duration-t)),p=r.playbackControls.playbackState=="NOT_PLAYING";S({cmd:"SET_ACTIVITY",args:{pid:2094112,activity:{...p?{smallImageKey:"paused-icon",smallImageText:"Paused"}:{startTimestamp:m,endTimestamp:d},type:2,name:a(e.title),details:a("by "+e.artists.map(g=>g.name).join(", ")),largeImageKey:l,largeImageText:`on ${a(e.album.title)}`}}})}))});async function k(){c.forEach(t=>t());try{f()}catch{}}export{k as onUnload};
