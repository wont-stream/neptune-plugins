import{store as d,intercept as g,currentMediaItem as p}from"@neptune";import{getMediaURLFromID as w}from"@neptune/utils";var i=[],n=t=>t.length>=128?t.slice(0,125)+"...":t,y,u,b=async()=>{let t=6463+(void 0).tries%10;u+=1,y=new WebSocket(`ws://127.0.0.1:${t}/?v=1&client_id=1130698654987067493`)},T=t=>{(void 0).ws.send(JSON.stringify(t))},I=()=>new Promise(t=>{(void 0).ws.close(),t()});b().then(()=>{i.push(g("playbackControls/TIME_UPDATE",([t])=>{let o=d.getState(),{item:s,type:a}=p;if(a!="track")return;let r=w(s.album.cover),e=new Date,c=e.getTime()/1e3|0,l=e.setSeconds(e.getSeconds()+(s.duration-t)),m=o.playbackControls.playbackState=="NOT_PLAYING";T({cmd:"SET_ACTIVITY",args:{pid:2094112,activity:{...m?{smallImageKey:"paused-icon",smallImageText:"Paused"}:{startTimestamp:c,endTimestamp:l},type:2,name:n(s.title),details:n("by "+s.artists.map(h=>h.name).join(", ")),largeImageKey:r,largeImageText:`on ${n(s.album.title)}`}}})}))});async function P(){i.forEach(t=>t());try{I()}catch{}}export{P as onUnload};
