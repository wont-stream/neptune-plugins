var r=[],c=s=>s.length>=128?s.slice(0,125)+"...":s,a=class{constructor(){this.ws=null,this.tries=0}async connect(){let t=6463+this.tries%10;this.tries+=1,this.ws=new WebSocket(`ws://127.0.0.1:${t}/?v=1&client_id=1130698654987067493`),this.ws.onopen=this.onOpen.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=this.onError.bind(this),this._once=[]}emit(t,e){this._once.forEach(n=>{if(n.evt==t)return n.cb(n)})}once(t,e){this._once.push({evt:t,cb:e})}onOpen(){r.push(neptune.intercept("playbackControls/TIME_UPDATE",([t])=>{let{item:e,type:n}=neptune.currentMediaItem;if(n!="track")return;let o=new Date,h=o.getTime()/1e3|0,m=o.setSeconds(o.getSeconds()+(e.duration-t)),l=neptune.store.getState().playbackControls.playbackState=="NOT_PLAYING";i.send(JSON.stringify({cmd:"SET_ACTIVITY",args:{pid:2094112,activity:{timestamps:{...l?{}:{start:h,end:m}},type:2,name:c(e.title),details:c("by "+e.artists.map(p=>p.name).join(", ")),assets:{large_image:`https://resources.tidal.com/images/${e.album.cover.split("-").join("/")}/80x80.jpg`,large_text:`on ${c(e.album.title)}`,...l?{small_image:"paused-icon",small_text:"Paused"}:{}}}}}))}))}onClose(t){t.wasClean&&this.emit("close",t)}onError(){r.forEach(t=>t());try{this.ws.close()}catch{}setTimeout(()=>{this.connect()},250)}send(t){this.ws.send(JSON.stringify(t))}close(){return new Promise(t=>{this.once("close",t),this.ws.close()})}},i=new a;i.connect();async function u(){if(r.forEach(s=>s()),i)try{i.close()}catch{}}export{u as onUnload};
