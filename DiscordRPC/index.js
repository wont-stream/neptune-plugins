import{store as g,intercept as y,currentMediaItem as u}from"@neptune";import{getMediaURLFromID as T}from"@neptune/utils";var s=[],n=e=>e.length>=128?e.slice(0,125)+"...":e,o=new WebSocket("ws://127.0.0.1:6463/?v=1&client_id=1130698654987067493"),I=e=>{o.send(JSON.stringify(e))},b=()=>new Promise(e=>{o.close(),e()});o.onopen(()=>{s.push(y("playbackControls/TIME_UPDATE",([e])=>{let c=g.getState(),{item:t,type:r}=u;if(r!="track")return;let i=T(t.album.cover),a=new Date,m=a.getTime()/1e3|0,l=a.setSeconds(a.getSeconds()+(t.duration-e)),d=c.playbackControls.playbackState=="NOT_PLAYING";I({cmd:"SET_ACTIVITY",args:{pid:2094112,activity:{...d?{smallImageKey:"paused-icon",smallImageText:"Paused"}:{startTimestamp:m,endTimestamp:l},type:2,name:n(t.title),details:n("by "+t.artists.map(p=>p.name).join(", ")),largeImageKey:i,largeImageText:`on ${n(t.album.title)}`}}})}))});async function w(){s.forEach(e=>e());try{b()}catch{}}export{w as onUnload};
